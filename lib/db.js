// Generated by CoffeeScript 1.7.1
(function() {
  var blue, client, mongo;

  blue = require('bluebird');

  mongo = require("mongodb");

  client = null;

  module.exports = function(req, res, next) {
    client || (client = new blue(function(resolve, reject) {
      return mongo.MongoClient.connect('mongodb://127.0.0.1:27017/' + req.settings.database, function(err, db) {
        if (err) {
          reject(err);
        }
        if (db) {
          return resolve(db);
        }
      });
    }));
    return client.then(function(db) {
      db.free = db.collection('ips_free');
      db.paid = db.collection('ips_paid');
      req.db = db;
      return next();
    });
  };

}).call(this);

//# sourceMappingURL=db.map
